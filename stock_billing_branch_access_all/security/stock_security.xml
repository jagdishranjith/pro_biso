<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="group_all_ou_stock" model="res.groups">
        <field name="name">Access all OUs' stock</field>
        <field name="category_id" ref="billing_branch.module_billing_branches" />
    </record>

    <function model="ir.rule" name="write">
        <value
            eval="[ref('stock_billing_branch.ir_rule_stock_warehouse_allowed_billing_branches'),
                   ref('stock_billing_branch.ir_rule_stock_location_allowed_billing_branches'),
                   ref('stock_billing_branch.ir_rule_stock_picking_allowed_billing_branches'),
                   ref('stock_billing_branch.ir_rule_stock_quant_allowed_billing_branches')]"
        />
        <value
            eval="{'domain_force': &quot;['|','|',(1, '=', 1) if user.has_group('stock_billing_branch_access_all.group_all_ou_stock') else (0, '=', 1),('billing_branch_id','=',False),('billing_branch_id','in', billing_branch_ids)]&quot;}"
        />
    </function>

    <function model="ir.rule" name="write">
        <value
            eval="[ref('stock_billing_branch.ir_rule_stock_picking_type_allowed_billing_branches')]"
        />
        <value
            eval="{'domain_force': &quot;[
                '|',(1, '=', 1) if user.has_group('stock_billing_branch_access_all.group_all_ou_stock') else (0, '=', 1),
                '|',
                ('warehouse_id','=',False),
                '|',
                ('warehouse_id.billing_branch_id','=', False),
                ('warehouse_id.billing_branch_id','in',billing_branch_ids)]&quot;}"
        />
    </function>

    <function model="ir.rule" name="write">
        <value
            eval="[ref('stock_billing_branch.ir_rule_stock_move_allowed_billing_branches'),
                   ref('stock_billing_branch.ir_rule_stock_move_line_allowed_billing_branches')]"
        />
        <value
            eval="{'domain_force': &quot;[
                '|',(1, '=', 1) if user.has_group('stock_billing_branch_access_all.group_all_ou_stock') else (0, '=', 1),
                '&amp;',
                '|',('location_id.billing_branch_id','=',False),
                ('location_id.billing_branch_id','in',billing_branch_ids),
                '|',('location_dest_id.billing_branch_id','=',False),
                ('location_dest_id.billing_branch_id','in',billing_branch_ids)]&quot;}"
        />
    </function>

    <function model="ir.rule" name="write">
        <value
            eval="[ref('stock_billing_branch.ir_rule_stock_picking_allowed_picking_type_billing_branches')]"
        />
        <value
            eval="{'domain_force': &quot;[
                '|',(1, '=', 1) if user.has_group('stock_billing_branch_access_all.group_all_ou_stock') else (0, '=', 1),
                '|','|',
                ('picking_type_id.warehouse_id','=', False),
                ('picking_type_id.warehouse_id.billing_branch_id','=',False),
                ('picking_type_id.warehouse_id.billing_branch_id','in',billing_branch_ids)]&quot;}"
        />
    </function>

</odoo>
